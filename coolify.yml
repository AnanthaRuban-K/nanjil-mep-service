# Coolify v4 Configuration for Nanjil MEP Service
version: '1.0'

applications:
  - name: nanjil-mep-frontend
    type: nextjs
    port: 3100
    dockerfile: Dockerfile.frontend
    build_command: "npm run build:frontend"
    start_command: "npm run start:frontend"
    environment_variables:
      - NODE_ENV=production
      - NEXT_PUBLIC_API_URL=${BACKEND_URL}
      - NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=${NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}
    domains:
      - nanjilmep.yourdomain.com
    health_check:
      path: /
      interval: 30s
      timeout: 10s
      retries: 3

  - name: nanjil-mep-backend
    type: nodejs
    port: 3101
    dockerfile: Dockerfile.backend
    build_command: "npm run build:backend"
    start_command: "npm run start:backend"
    environment_variables:
      - NODE_ENV=production
      - PORT=3101
      - DATABASE_URL=${DATABASE_URL}
      - CLERK_SECRET_KEY=${CLERK_SECRET_KEY}
      - CORS_ORIGINS=${FRONTEND_URL}
    domains:
      - api.nanjilmep.yourdomain.com
    health_check:
      path: /health
      interval: 30s
      timeout: 10s
      retries: 3

databases:
  - name: nanjil-mep-postgres
    type: postgresql
    version: '15'
    database_name: nanjil_mep_prod
    username: nanjil_user
    port: 5432